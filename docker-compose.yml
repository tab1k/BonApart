version: '3'

volumes:
 postgres_data:
 certbot_data:  # Add this line to define the certbot_data volume

services:
 db:
   image: postgres
   volumes:
     - postgres_data:/var/lib/postgresql/data
   environment:
     - POSTGRES_USER=tab1k
     - POSTGRES_PASSWORD=TOBI8585
     - POSTGRES_DB=bonapart_db
   ports:
     - "5433:5432"

 web:
   build: .
   tty: true
   command: >
     bash -c "python manage.py migrate && python manage.py runserver 0.0.0.0:8000"
   restart: always
   volumes:
     - .:/code
     - .:/static
     - .:/media
   ports:
     - "8000:8000"
   depends_on:
     - db

 certbot:
   image: certbot/certbot
   command: certonly --webroot --webroot-path=/code/static --agree-tos --email tabigatkarbayev@icloud.com -d bonapart.kz
   volumes:
     - ./certbot_data:/code/static
   depends_on:
     - web
   ports:
     - "80:80"
     - "443:443"


